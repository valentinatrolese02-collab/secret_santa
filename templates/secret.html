<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8" />
    <title>Il tuo destinatario</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}" />
    <!-- Font natalizio da Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Mountains+of+Christmas&display=swap" rel="stylesheet" />
    <style>
        body {
            font-family: 'Mountains of Christmas', cursive;
            background-color: #0b1e3d; /* blu notte */
            color: #fff;
            margin: 0;
            padding: 0;
        }
        #snow {
            position: fixed;
            top: 0; left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
        }
        #wrapper {
            position: relative;
            z-index: 1; /* sopra la neve */
            padding: 20px;
            max-width: 600px;
            margin: auto;
            text-align: center;
        }
        header#header img {
            border-radius: 10px;
            margin-top: 15px;
            max-width: 100%;
            height: auto;
        }
        footer#footer {
            margin-top: 40px;
            font-size: 0.9em;
            color: #ccc;
        }
        #countdown {
            font-size: 1.8em;
            margin: 20px 0;
        }
        audio {
            position: fixed;
            bottom: 10px;
            right: 10px;
            width: 200px;
            z-index: 10000;
        }
    </style>
</head>
<body class="is-preload">
    <canvas id="snow"></canvas>

    <div id="wrapper">
        <header id="header">
            <h2>Tvoia {{ participant }}!</h2>
            <p>
                Il culo del destino ha parlato! Devi fare il regalo alla tvoia:<br /><br />
                <strong style="font-size: 1.5em;">{{ receiver }}</strong>
            </p>
            <img src="{{ url_for('static', filename=receiver_img) }}" alt="{{ receiver }}" />
        </header>

        <div id="countdown"></div>

        <footer id="footer">
            <p>&copy; Secret MTR 2025. Non dire niente a nessuno ðŸ˜¶</p>
        </footer>
    </div>

    <!-- Neve che cade -->
    <script>
        const canvas = document.getElementById('snow');
        const ctx = canvas.getContext('2d');
        let width, height;
        let snowflakes = [];

        function resize() {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
        }

        window.addEventListener('resize', resize);
        resize();

        function createSnowflakes() {
            for (let i = 0; i < 100; i++) {
                snowflakes.push({
                    x: Math.random() * width,
                    y: Math.random() * height,
                    r: Math.random() * 4 + 1,
                    d: Math.random() * 1,
                });
            }
        }

        function draw() {
            ctx.clearRect(0, 0, width, height);
            ctx.fillStyle = 'white';
            ctx.beginPath();
            for (let i = 0; i < snowflakes.length; i++) {
                let f = snowflakes[i];
                ctx.moveTo(f.x, f.y);
                ctx.arc(f.x, f.y, f.r, 0, Math.PI * 2, true);
            }
            ctx.fill();
            update();
        }

        let angle = 0;

        function update() {
            angle += 0.01;
            for (let i = 0; i < snowflakes.length; i++) {
                let f = snowflakes[i];
                f.y += Math.cos(angle + f.d) + 1 + f.r / 2;
                f.x += Math.sin(angle) * 2;

                if (f.y > height) {
                    snowflakes[i] = { x: Math.random() * width, y: 0, r: f.r, d: f.d };
                }
            }
        }

        createSnowflakes();
        setInterval(draw, 33);

        // Countdown Natale
        function countdown() {
            const now = new Date();
            const year =
                now.getMonth() === 11 && now.getDate() > 25 ? now.getFullYear() + 1 : now.getFullYear();
            const christmas = new Date(year, 11, 25);
            const diff = christmas - now;

            if (diff <= 0) {
                document.getElementById('countdown').innerHTML = 'ðŸŽ„ Ãˆ Natale! ðŸŽ‰';
                return;
            }

            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
            const minutes = Math.floor((diff / (1000 * 60)) % 60);
            const seconds = Math.floor((diff / 1000) % 60);

            document.getElementById('countdown').innerHTML =
                `Mancano ${days} giorni, ${hours} ore, ${minutes} minuti e ${seconds} secondi a Natale!`;
        }

        setInterval(countdown, 1000);
        countdown();
    </script>
</body>
</html>

